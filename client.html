<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Tag Battle</title>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
  html,body { height:100%; margin:0; font-family: 'Roboto', sans-serif; }
  body { background: linear-gradient(135deg,#1e3c72,#2a5298); display:flex; justify-content:center; align-items:flex-start; }

  .container { background:#fff; padding:30px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.4); width:360px; margin:40px auto; text-align:center; }
  h1 { margin:0 0 12px 0; color:#00ff00; text-transform:uppercase; letter-spacing:2px; text-shadow:0 0 8px #0f0; }
  input { width:100%; padding:10px; margin:8px 0; border-radius:8px; border:1px solid #ccc; }
  button { width:100%; padding:12px; margin:8px 0; background:#00ff00; border:none; border-radius:8px; font-weight:700; cursor:pointer; }
  .toggle-btn { background:none; border:none; color:#2a5298; cursor:pointer; font-size:14px; }

  #homepage { display:none; width:700px; max-width:calc(100vw - 40px); padding:40px; box-sizing:border-box; position:relative; }
  .logout-btn { position:absolute; top:18px; right:18px; background:red; color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
  #play-btn { width:320px; height:96px; font-size:28px; border-radius:16px; display:block; margin:48px auto; }
  #online-players { text-align:left; background:#f4f4f4; padding:12px; border-radius:8px; max-height:200px; overflow:auto; }

  .small-card { display:none; width:360px; background:#fff; padding:20px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.4); margin:20px auto; text-align:center; }

  #game-root { display:none; position:fixed; inset:0; width:100%; height:100%; background:#000; z-index:1000; }
  #crosshair {
    position:fixed; left:50%; top:50%; width:14px; height:14px; margin-left:-7px; margin-top:-7px; pointer-events:none;
  }
  #crosshair:before, #crosshair:after {
    content:''; position:absolute; left:50%; top:50%; background:#fff; transform:translate(-50%,-50%); 
  }
  #crosshair:before { width:2px; height:14px; }
  #crosshair:after { width:14px; height:2px; }

  .hint { font-size:13px; color:#666; margin-top:8px; }
</style>
</head>
<body>

<div class="container" id="auth-container">
  <h1>Ultra Tag Battle</h1>
  <div id="message" style="min-height:20px"></div>
  <input id="email" type="email" placeholder="Email" />
  <input id="password" type="password" placeholder="Password" />
  <button id="signup-btn">Sign Up</button>
  <button id="login-btn">Log In</button>
  <button class="toggle-btn" id="show-lobby-btn">Go to Lobby (if logged in)</button>
  <p class="hint">Create an account, then log in. First login requires a username (kept permanently).</p>
</div>

<div class="small-card" id="username-card">
  <h3>Create your username</h3>
  <input id="username-field" placeholder="Choose a username (letters/numbers only)" />
  <button id="save-username">Save Username</button>
  <div id="username-feedback" style="min-height:18px"></div>
</div>

<div id="homepage" class="container">
  <button class="logout-btn" id="logout-btn">Log Out</button>
  <h1>Ultra Tag Battle</h1>
  <button id="play-btn">Play Now</button>
  <h3 style="margin-top:24px;">Online Players</h3>
  <div id="online-players"><em>Loading...</em></div>
</div>

<div id="game-root">
  <div id="crosshair"></div>
  <button class="logout-btn" id="exit-game-btn" style="right:18px; top:18px;">Exit Game</button>
</div>

<script type="module">
// Firebase init
const firebaseConfig = { /* your config here */ };
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// (same login/signup/username logic as before â€” omitted here for brevity, unchanged)

// Fix: when gameRoot is hidden, it no longer blocks clicks
function enterGameScene() {
  document.getElementById('game-root').style.display = 'block';
  document.body.style.cursor = 'none';
  // init three.js, pointer lock, etc.
}
function cleanupGame() {
  document.getElementById('game-root').style.display = 'none';
  document.body.style.cursor = 'default';
}
document.getElementById('exit-game-btn').addEventListener('click', cleanupGame);
</script>
</body>
</html>
